<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>地震情報（リアルタイム更新）</title>
    <style>
        /* 常に更新されているか視覚的にわかるよう、少しスタイルを整えています */
        body { font-family: sans-serif; line-height: 1.6; }
        #display { padding: 10px; border: 1px solid #ccc; border-radius: 5px; display: inline-block; min-width: 250px; }
        .last-update { font-size: 0.8em; color: #666; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>地震情報（最新）</h1>
    <div id="display">読み込み中...</div>
    <div class="last-update" id="timestamp"></div>

    <script>
        const api_url = "https://api.wolfx.jp/jma_eew.json";

        // マグニチュードの色を決定する関数
        function getMagColor(mag) {
            const m = parseFloat(mag);
            if (isNaN(m)) return "#000000";
            if (m >= 6.5) return "#982ABC";
            if (m >= 6.0) return "#FF0000";
            if (m >= 5.0) return "#FFAB01";
            if (m >= 4.0) return "#FED030";
            return "#000000";
        }

        // 震度の色を決定する関数
        function getIntColor(intensity) {
            if (!intensity) return "#000000";
            const s = intensity.toString();
            if (s.includes('7')) return "#982ABC";
            if (s.includes('6')) return "#FF0000";
            if (s.includes('5')) return "#FFAB01";
            if (s.includes('3') || s.includes('4')) return "#FED030";
            return "#000000";
        }

        async function getEEW() {
            try {
                // cache: "no-store" で最新情報を強制取得
                const response = await fetch(api_url, { cache: "no-store" });
                if (!response.ok) throw new Error(`エラー: ${response.status}`);
                
                const API = await response.json();
                
                const mColor = getMagColor(API.Magunitude);
                const iColor = getIntColor(API.Intensity);

                document.getElementById('display').innerHTML = 
                    `発表: ${API.AnnouncedTime || '不明'}<br>` +
                    `場所: ${API.Hypocenter || '情報なし'}<br>` +
                    `マグニチュード: <span style="color: ${mColor}; font-weight: bold;">${API.Magunitude || '不明'}</span><br>` +
                    `震度: <span style="color: ${iColor}; font-weight: bold;">${API.Intensity || '不明'}</span>`;
                
                // 最終更新時刻を表示（動作確認用）
                const now = new Date();
                document.getElementById('timestamp').innerText = "最終取得時刻: " + now.toLocaleTimeString();

            } catch (e) {
                // 取得失敗時も画面が止まらないようエラー表示
                console.error("Fetch error:", e);
                document.getElementById('timestamp').innerText = "取得失敗: " + e.message;
            }
        }

        // 初回実行
        getEEW();

        // 500ミリ秒（0.5秒）ごとに実行
        setInterval(getEEW, 500);
    </script>
</body>
</html>
